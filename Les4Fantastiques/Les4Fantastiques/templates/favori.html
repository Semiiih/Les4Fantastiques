{% extends "_base.html" %}
{% load static %}

{% block title %}Favoris{% endblock %}

{% block content %}
<div class='bg-custom'>
    <div class="container page-content ">
    <h2 class='pt-5'>Vos personnages en favoris</h2>
    <div id="favorites-container" class="row"></div>

    <h2 class='espace' >Vos s√©ries en favoris</h2>
    <div id="favorites-series-container" class="row"></div>
    </div>
</div>

<style>
    .page-content {
        padding-right: 150px ; 
        padding-left: 150px ; 
        max-width: 95%; 
    }

    .bg-custom {
        background: linear-gradient(135deg, #03507E 30%, #D20505 100%);
      }

    .espace{
        padding-top: 40px;
    }
    h1 {
        color: white;
        margin-top: 80px;
    }
  
    h2 {
        color: white;
        margin-bottom: 40px;
    }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    const charactersContainer = document.getElementById("favorites-container");

    if (favorites.length === 0) {
        charactersContainer.innerHTML = "<p>Vous n'avez pas encore ajout√© de personnages en favoris.</p>";
    } else {
        let htmlContent = "";
        favorites.forEach((character) => {
            const imgSrc = character.thumbnail && character.thumbnail.path && character.thumbnail.extension
                ? `${character.thumbnail.path}.${character.thumbnail.extension}`
                : '{% static "default-character.jpeg" %}'; 
            htmlContent += `
                <div class="col-md-3">
                    <div class="card mb-4" style="position: relative;">
                        <img src="${imgSrc}" class="height100" alt="${character.name}">
                        <div class="card-body">
                            <h5 class="card-title">${character.name}</h5>
                            <p class="card-text">${character.description || "Description non disponible."}</p>
                        </div>
                        <button class="delete-btn" data-id="${character.id}" style="position: absolute; top: 10px; right: 10px; background-color: white; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `;
        });
        charactersContainer.innerHTML = htmlContent;

        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', (event) => {
                const characterId = event.target.getAttribute('data-id');
                removeFromFavorites(characterId);
            });
        });
    }

    function removeFromFavorites(characterId) {
        favorites = favorites.filter(character => character.id != characterId);
        localStorage.setItem('favorites', JSON.stringify(favorites));
        location.reload();
    }

    // R√©cup√©ration des s√©ries favorites
    let favoritesSeries = JSON.parse(localStorage.getItem('favoritesSeries')) || [];
    const seriesContainer = document.getElementById("favorites-series-container");

    if (favoritesSeries.length === 0) {
        seriesContainer.innerHTML = "<p>Vous n'avez pas encore ajout√© de s√©ries en favoris.</p>";
    } else {
        let seriesHtmlContent = "";
        favoritesSeries.forEach((serie) => {
            const imgSrc = serie.thumbnail && serie.thumbnail.path && serie.thumbnail.extension
                ? `${serie.thumbnail.path}.${serie.thumbnail.extension}`
                : '{% static "default-character.jpeg" %}';
                
            seriesHtmlContent += `
                <div class="col-md-3">
                    <div class="card mb-4" style="position: relative;">
                        <img src="${imgSrc}" class="height100" alt="${serie.name}">
                        <div class="card-body">
                            <h5 class="card-title">${serie.name}</h5>
                            <p class="card-text">${serie.description || "Description non disponible."}</p>
                        </div>
                        <button class="delete-series-btn" data-id="${serie.id}" style="position: absolute; top: 10px; right: 10px; background-color: white; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `;
        });
        seriesContainer.innerHTML = seriesHtmlContent;

        // Ajouter des √©v√©nements de clic pour supprimer une s√©rie des favoris
        document.querySelectorAll('.delete-series-btn').forEach(button => {
            button.addEventListener('click', (event) => {
                const serieId = event.target.getAttribute('data-id');
                removeFromSeriesFavorites(serieId);
            });
        });
    }

    // Fonction pour supprimer une s√©rie des favoris
    function removeFromSeriesFavorites(serieId) {
        favoritesSeries = favoritesSeries.filter(serie => serie.id != serieId);
        localStorage.setItem('favoritesSeries', JSON.stringify(favoritesSeries));
        location.reload();
    }
});
</script>
{% endblock %}
